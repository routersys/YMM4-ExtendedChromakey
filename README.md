# 拡張クロマキープラグイン for YMM4
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)
[![.NET](https://img.shields.io/badge/.NET-9.0-purple.svg)](#)
[![Release](https://img.shields.io/github/v/release/routersys/YMM4-ExtendedChromakey.svg)](https://github.com/routersys/YMM4-ExtendedChromakey/releases)

YMM4（YukkuriMovieMaker v4）で、高度なクロマキー合成を実現するエフェクトプラグインです。

![chromakey](https://github.com/routersys/YMM4-ExtendedChromakey/blob/main/chromakey.png)

---

### 概要

標準のクロマキーでは難しいグラデーション背景や、微細な色調整、意図しない色が抜けてしまう問題などを解決するために開発されました。多彩なパラメータで、思い通りの背景透過を実現します。

### 主な機能

- **グラデーションキーイング**: 2つの色を指定し、その間のグラデーション範囲をキーイング対象にできます。
- **多彩な色空間**: RGBだけでなく、HSVやCIE Labなど知覚的に分かりやすい色空間でのキーイングが可能です。
- **詳細な調整項目**: 「許容値」「輝度ミックス」「エッジの柔らかさ」「クリップ(白/黒)」など、40以上のパラメータで細かく調整できます。
- **例外（保護）設定**: 「この色だけは絶対に抜きたくない」という色を指定し、キーイング処理から除外できます。
- **高品質なエッジ処理**: スピル除去、エッジの侵食・ぼかし・彩度除去など、合成の品質を高める機能が豊富に用意されています。
- **色補正機能**: クロマキーで残った背景色を他の色に変換して目立たなくすることができます。
- **透明度品質向上**: 煙や透明な素材に対する処理品質を改善します。
- **検証**: 設定に問題がある場合、自動的に警告やアドバイスを表示します。

---

### 機能詳細
![settings](https://github.com/routersys/YMM4-ExtendedChromakey/blob/main/settings.png)

| グループ | 項目 | 説明 |
|:---|:---|:---|
| **基本設定** | 基本色 | 透過する基本色を指定します。 |
| | 終端色 | グラデーションの終端色を指定します。基本色とこの色の間がクロマキー対象になります。 |
| **キーイングモード** | 主要キーイング色 | キーイングの基準となる主要な色（緑・青・赤）を選択、またはカスタム色を指定します。 |
| | 色空間(カスタム用) | `主要キーイング色`が`カスタム`の時に、色距離の計算に使用する色空間を選択します。 |
| | 色相範囲 | `HSV/LCH`色空間使用時の色相の許容範囲です。 |
| | 彩度閾値 | この値以下の彩度の色は、彩度を無視して明度で比較されます。 |
| | 明度範囲 | `RGB/YUV`色空間使用時の明度差の許容範囲です。 |
| **キーイング調整** | 許容値 | 色の許容範囲。0%に設定すると選択した色のみが対象になります。 |
| | 輝度ミックス | 輝度をキーイング判定にどれだけ使用するかを調整します。 |
| | エッジの柔らかさ | 透過境界の柔らかさを調整します。 |
| | クリップ(黒) | マスクの黒レベルを調整します。背景のノイズ除去に有効です。 |
| | クリップ(白) | マスクの白レベルを調整します。前景をくっきりと残すのに有効です。 |
| | エッジぼかし | マスクの境界をぼかして滑らかにします。 |
| **グラデーション** | グラデーション強度 | 0%で基本色のみ、100%で基本色から終端色へのグラデーションになります。 |
| | グラデーション角度 | グラデーションの方向を度数で指定します。 |
| **例外設定** | 例外色1 (基本) | クロマキーから除外（保護）する基本色を指定します。透明の場合は無効です。 |
| | 例外色2 (終端) | 保護する色のグラデーション終端色を指定します。 |
| | 許容値 | 保護する色の許容範囲を指定します。 |
| | グラデーション強度 | 保護する色のグラデーションの強さを指定します。 |
| | グラデーション角度 | 保護する色のグラデーションの角度を指定します。 |
| **品質最適化** | スピル除去 | 背景色の被写体への全体的な映り込み（色かぶり）を除去します。 |
| | エッジバランス | キーイングの境界を内外に調整します。プラスで内側、マイナスで外側に移動します。 |
| | デスポット | マスク内の小さなノイズ（穴やゴミ）を除去します。 |
| | エッジの浸食 | マスクの境界を拡大・縮小します。輪郭に残る細いフリンジの除去に有効です。 |
| | エッジの色のじみ除去 | 輪郭部分の色の映り込みを低減させ、より自然な合成を実現します。 |
| | キー・クリーンアップ | キーイングしたマスクの境界を調整します。マイナスで縮小、プラスで拡大します。 |
| | エッジ検出 | 輪郭のディテールを保持する強度。上げるとエッジがシャープになります。 |
| | ノイズ除去 | マスクから細かいノイズを除去します。 |
| | フェザリング | マスクのエッジをぼかして、背景となじませます。 |
| **🆕 色補正** | 残存色補正 | クロマキーで残った背景色を他の色に変換します。 |
| | 補正対象色 | 補正したい残存色を指定します。（例：残った緑色） |
| | 補正後の色 | 残存色をこの色に変換します。（例：グレー） |
| | 補正許容値 | 色補正の許容範囲。値を大きくすると、より広い範囲の色が補正されます。 |
| **🆕 高度な設定** | 透明度品質 | 透明度の高い部分（煙など）の処理品質を向上させます。 |
| | アルファブレンド調整 | 前景と背景の混合処理を調整します。 |
| **色置換** | 置換色 | 除去した領域を置き換える色を指定します。 |
| | 置換の強度 | 除去領域を置換色で塗りつぶす強度を指定します。 |
| | 輝度保持 | 色置換時に元の輝度をどれだけ保持するかを指定します。 |
| **その他** | 完全クロマキー | オンにすると、輝度を保持せず完全に透過させます。スピル除去なども無効になります。 |
| | 反転 | 透過範囲を反転します。 |
| | 品質プリセット | 処理の品質を選択します。高品質ほど処理が重くなります。 |
| **デバッグ** | 表示モード | 最終結果・マスク表示・色距離・スピル除去後・色補正後から選択できます。 |

---

### 導入方法

1. **[リリースページ](https://github.com/routersys/YMM4-ExtendedChromakey/releases)** から最新版の `.ymme` をダウンロードします。
2. ダウンロードした ymme ファイルをダブルクリックします。
3. インストール完了です。

### 使い方

1. タイムライン上のアイテム（動画・画像）を選択します。
2. 設定パネルの「映像エフェクト」から「**拡張クロマキー**」を選択します。
3. 基本的な設定から始めて、必要に応じて高度な機能を使用してください。

### 免責事項

このプラグインを使用したことによって生じた、いかなる損害についても作者は責任を負いません。自己責任でご利用ください。
